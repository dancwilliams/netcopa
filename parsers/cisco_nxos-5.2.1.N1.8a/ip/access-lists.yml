- name: ip access-list
  tags:
  - ip
  - access-list
  matches:
  - name: ip access-list extended
    template: ip/access-lists/default.j2
    lines:
    - regex: '^ip access-list (\S+)$'
      examples:
      - 'ip access-list qo-global-core-voice-signal'
      captures:
      - name
      path:
        ip:
          access_lists:
            "\"{{ name }}\"":
                name: "\"{{ name }}\""
      lines:
# REMARKS
      - regex: '^  (\d{1,5}) remark (.*)$'
        examples:
        - '  10 remark foo'
        captures:
        - sequence
        - remark
        path:
          ip:
            access_lists:
              "\"{{ name }}\"":
                entries:
                - remark: "\"{{ remark }}\""
                  sequence: "\"{{ sequence }}\""
      - regex: '^  (\d{1,5}) remark$'
        examples:
        - '  10 remark foo'
        path:
          ip:
            access_lists:
              "\"{{ name }}\"":
                entries:
                - remark:
                  sequence: "\"{{ sequence }}\""
# NETWORK TO ANY
      - regex: '^  (\d{1,5}) (permit|deny) (\S+) (\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\/([1-9]|[1-2][0-9]|3[0-2]) any$'
        examples:
        - '  20 permit ip 192.35.38.0/24 any'
        captures:
        - sequence
        - action
        - protocol
        - source_network
        - source_cidr_mask
        path:
          ip:
            access_lists:
              "{{ name }}":
                entries:
                - protocol: "\"{{ protocol }}\""
                  action: "\"{{ action }}\""
                  source_network: "\"{{ source_network }}\""
                  source_wildcard: "\"{{ source_cidr_mask }}\""
                  destination_network: 0.0.0.0
                  destination_wildcard: 255.255.255.255
                  sequence: "\"{{ sequence }}\""